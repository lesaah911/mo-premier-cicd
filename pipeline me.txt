pipeline {
    agent any
    stages {
       stage ('Preparation') {
          steps {
             echo 'Début du deploiement...'
             echo 'Déploiement du build'
            }
        }

      stage ('verification des déchets') {
          echo 'verification des dossiers'
          sh '''
          ls -la
          cat website/site.html
          '''
       }
       stage ('Deploiement de Ansible') {
         echo 'Déploiment du playbook'
         sh '''
         cd var/lib/jenkins/workspace/${JOB_NAME}
         ansible-playbook -i inventory.ini deploy.yml
         '''
       }
       stage ('Test du déploieent') {
         echo 'Vérification que le site est accessible'
         sh '''
             sleep 5
             curl - http://ip_address_app
             '''
       }
    }
  post {
       success {
          echo 'Deploiement réussi'
          echo 'Votre site est accessible sur le http://ip_app_serveur'
       }
       faillure {
          echo 'le déploiement a échouer'
       }
  }
}  